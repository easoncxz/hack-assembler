
language: generic

cache:
    directories:
        - $HOME/.stack/
        - .stack-work
    timeout: 1000

install:
    - ./automation/install-stack.sh

script:
    - stack --no-terminal test

jobs:
    include:

        #- stage: test
        #  os: osx
        #  osx_image: xcode6.4 # macOS 10.10 yosemite
        #- stage: test
        #  os: osx
        #  osx_image: xcode8 # macOS 10.11 el_capitan
        #- stage: test
        #  os: osx
        #  osx_image: xcode9.2 # macOS 10.12 sierra
        #- stage: test
        #  os: osx
        #  osx_image: xcode10 # macOS 10.13 high_sierra

        - stage: "Bottle and upload"
          os: osx
          osx_image: xcode6.4 # macOS 10.10 yosemite

          install:
              - ./automation/install-stack.sh
              - bash --login automation/install-homebrew-automation.sh
              - rvm reload
              - rvm use "$(cat .ruby-version)" --install
          script:
              - homebrew_automation.rb help
              - stack --no-terminal test
          before_deploy:
              - echo "Pretent we're building a bottle here"
          deploy:
              provider: script
              script: echo "Pretent we're uploading files to Bintray here"
              skip_cleanup: true
              on:
                  tags: true


        - stage: "Bottle and upload"
          os: osx
          osx_image: xcode8 # macOS 10.11 el_capitan

          install:
              - ./automation/install-stack.sh
              - bash --login automation/install-homebrew-automation.sh
              - rvm reload
              - rvm use "$(cat .ruby-version)" --install
          script:
              - homebrew_automation.rb help
              - stack --no-terminal test
          before_deploy:
              - echo "Pretent we're building a bottle here"
          deploy:
              provider: script
              script: echo "Pretent we're uploading files to Bintray here"
              skip_cleanup: true
              on:
                  tags: true


        - stage: "Bottle and upload"
          os: osx
          osx_image: xcode9.2 # macOS 10.12 sierra

          install:
              - ./automation/install-stack.sh
              - bash --login automation/install-homebrew-automation.sh
              - rvm reload
              - rvm use "$(cat .ruby-version)" --install
          script:
              - homebrew_automation.rb help
              - stack --no-terminal test
          before_deploy:
              - echo "Pretent we're building a bottle here"
          deploy:
              provider: script
              script: echo "Pretent we're uploading files to Bintray here"
              skip_cleanup: true
              on:
                  tags: true


        - stage: "Bottle and upload"
          os: osx
          osx_image: xcode10 # macOS 10.13 high_sierra

          install:
              - ./automation/install-stack.sh
              - bash --login automation/install-homebrew-automation.sh
              - rvm reload
              - rvm use "$(cat .ruby-version)" --install
          script:
              - homebrew_automation.rb help
              - stack --no-terminal test
          before_deploy:
              - echo "Pretent we're building a bottle here"
          deploy:
              provider: script
              script: echo "Pretent we're uploading files to Bintray here"
              skip_cleanup: true
              on:
                  tags: true


        - stage: "Publish bottles"
          os: linux
          sudo: false
          language: minimal
          install: echo "Nothing to install"
          script: echo "Nothing to test"
          deploy:
              provider: script
              script: echo "Pretend we're gathering and publishing bottles here."
              skip_cleanup: true
              on:
                tags: true
